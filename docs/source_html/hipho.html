<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>High School Physics Olympiad Benchmark (HiPhO)</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      font-family: Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
    }
    .container {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 24px;
      box-sizing: border-box;
      height: auto;
      align-items: center;
    }
    .title {
      font-size: 32px;
      font-weight: 800;
      letter-spacing: 0.2px;
      text-align: center;
    }
    #chart {
      width: 1200px;
      height: 450px;
      background: transparent;
      border-radius: 8px;
    }
    a { color: #b39ddb; }
    .legend {
      display: flex;
      gap: 24px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }
    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 18px;
      opacity: 0.9;
    }
    .legend-swatch {
      width: 24px;
      height: 16px;
      border-radius: 3px;
      border: 1px solid rgba(255,255,255,0.3);
    }
    .medal-legend {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-left: 20px;
    }
    .medal-gradient {
      display: flex;
      height: 16px;
      border-radius: 3px;
      overflow: hidden;
    }
    .medal-gradient-item {
      width: 20px;
      height: 16px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="title">High School Physics Olympiad Benchmark (HiPhO)</div>
    <div id="legend" class="legend"></div>
    <div id="chart"></div>
  </div>

  <script>
    let currentTheme = 'dark';
    
    function getTheme() { return currentTheme; }
    function setTheme(theme) { currentTheme = theme; }
    function isLightTheme() { return currentTheme === 'light'; }
    
    function getThemeColors() {
      const isLight = isLightTheme();
      return {
        purpleMain: '#BA8FFF',
        redMain: '#FF6B6B',
        grayDark: isLight ? '#6B7280' : '#4a5057',
        grayMid: isLight ? '#6B7280' : '#4a5057',
        textPrimary: isLight ? '#1A1A1A' : '#FFFFFF',
        bgTooltip: isLight ? 'rgba(255,255,255,0.95)' : 'rgba(0,0,0,0.8)',
        tooltipBorder: '#7C4DFF',
        stripeColor: isLight ? 'rgba(255,255,255,0.6)' : 'rgba(255,255,255,0.3)'
      };
    }

    // 数据 - 按分数从高到低排序
    const rawData = [
      { label: 'Gemini-3-Pro(high)', value: 42.7, medals: 13 },
      { label: 'P1-VL-235B-A22B+\nPhysicsMinions', value: 40.9, medals: 12 },
      { label: 'GPT-5.2(high)', value: 40.6, medals: 12 },
      { label: 'P1-VL-235B-A22B', value: 39.3, medals: 12 },
      { label: 'P1-235B-A22B+\nPhysicsMinions', value: 38.4, medals: 12 },
      { label: 'Gemini-2.5-Pro', value: 37.7, medals: 12 },
      { label: 'GPT-5', value: 37.4, medals: 11 },
      { label: 'DeepSeek-V3.2-Thinking', value: 36.9, medals: 11 },
      { label: 'P1-235B-A22B', value: 35.9, medals: 12 },
      { label: 'o3', value: 35.3, medals: 11 },
      { label: 'Grok-4', value: 35.8, medals: 10 },
      { label: 'P1-VL-30B-A3B', value: 35.0, medals: 9 },
      { label: 'Qwen3-VL-235B\n-A22B-Thinking', value: 33.9, medals: 10 },
      { label: 'Qwen3-235B-A22B\n-Thinking-2507', value: 33.5, medals: 10 },
      { label: 'Gemini-2.5-Flash\n-Thinking', value: 32.1, medals: 12 },
      { label: 'DeepSeek-R1', value: 31.7, medals: 8 },
      { label: 'Claude-4-Sonnet\n-Thinking', value: 30.0, medals: 8 },
      { label: 'P1-30B-A3B', value: 32.5, medals: 8 },
      { label: 'Qwen3-VL-30B-A3B', value: 29.7, medals: 8 },
      { label: 'GPT-OSS-120B(high)', value: 32.4, medals: 12 }
    ].sort((a, b) => b.value - a.value);

    const labels = rawData.map(d => d.label);
    const values = rawData.map(d => d.value);
    const medals = rawData.map(d => d.medals);

    // 分类
    const closedSource = new Set([
      'Gemini-3-Pro(high)', 'GPT-5.2(high)', 'GPT-5', 'o3', 'o4-mini (high)', 'o4-mini',
      'Gemini-2.5-Pro', 'Gemini-2.5-Flash-Thinking', 'Claude-4-Sonnet-Thinking', 'Grok-4',
      'GPT-4o', 'Claude-4-Sonnet', 'Mistral-Medium-3'
    ]);
    
    const p1Series = new Set([
      'P1-VL-235B-A22B+PhysicsMinions', 'P1-VL-235B-A22B', 'P1-VL-30B-A3B'
    ]);

    const solverModels = new Set([
      'P1-VL-235B-A22B+PhysicsMinions'
    ]);

    const normalize = (s) => s.replace(/\n/g, '').replace(/-/g, '').replace(/ /g, '');
    const closedSourceNorm = new Set(Array.from(closedSource).map(normalize));
    const p1SeriesNorm = new Set(Array.from(p1Series).map(normalize));
    const solverModelsNorm = new Set(Array.from(solverModels).map(normalize));

    function isClosedLabel(label) { return closedSourceNorm.has(normalize(label)); }
    function isP1Label(label) { return p1SeriesNorm.has(normalize(label)); }
    function isSolverLabel(label) { return solverModelsNorm.has(normalize(label)); }

    // 金牌数量到颜色的渐变
    const minMedals = Math.min(...medals);
    const maxMedals = Math.max(...medals);

    function hexToRgb(hex) {
      hex = hex.replace('#', '');
      if (hex.length === 8) {
        return [parseInt(hex.slice(0,2), 16), parseInt(hex.slice(2,4), 16), parseInt(hex.slice(4,6), 16), parseInt(hex.slice(6,8), 16)];
      }
      return [parseInt(hex.slice(0,2), 16), parseInt(hex.slice(2,4), 16), parseInt(hex.slice(4,6), 16)];
    }

    function rgbToHex(rgb) {
      if (rgb.length === 4) {
        return '#' + rgb.map(x => Math.round(x).toString(16).padStart(2, '0')).join('');
      }
      return '#' + rgb.slice(0,3).map(x => Math.round(x).toString(16).padStart(2, '0')).join('');
    }

    const goldColor = hexToRgb('#F7D411');
    const bronzeColor = hexToRgb('#CC5500');

    function medalToColor(medalCount) {
      if (maxMedals === minMedals) return rgbToHex(goldColor);
      let ratio = (medalCount - minMedals) / (maxMedals - minMedals);
      if (medalCount === 9) ratio = Math.min(ratio * 1.75, 0.35);
      
      const interpolated = goldColor.map((g, i) => g * ratio + bronzeColor[i] * (1 - ratio));
      return rgbToHex(interpolated);
    }

    function getStripeDecal() {
      const colors = getThemeColors();
      return {
        symbol: 'rect',
        dashArrayX: [1, 0],
        dashArrayY: [4, 3],
        rotation: Math.PI / 4,
        color: colors.stripeColor
      };
    }

    let colors = getThemeColors();

    function createDataArray() {
      const currentColors = getThemeColors();
      return labels.map((lb, i) => {
        const val = values[i];
        const medalCount = medals[i];
        const isSolver = isSolverLabel(lb);
        const isP1 = isP1Label(lb);
        const isClosed = isClosedLabel(lb);
        
        const baseColor = medalToColor(medalCount);
        const applyStripe = isClosed && !isP1;
        
        // 边框设置
        let borderColor = 'transparent';
        let borderWidth = 0;
        if (isSolver) {
          borderColor = currentColors.redMain;
          borderWidth = 4;
        } else if (isP1) {
          borderColor = currentColors.purpleMain;
          borderWidth = 4;
        }
        
        // 标签颜色
        let labelColor = currentColors.textPrimary;
        if (isSolver) {
          labelColor = currentColors.redMain;
        } else if (isP1) {
          labelColor = currentColors.purpleMain;
        }
        
        return {
          value: val,
          itemStyle: {
            color: baseColor,
            borderColor: borderColor,
            borderWidth: borderWidth,
            decal: applyStripe ? getStripeDecal() : null,
            borderRadius: [3, 3, 0, 0]
          },
          label: {
            show: true,
            position: 'top',
            color: labelColor,
            fontSize: 14,
            fontWeight: (isP1 || isSolver) ? 'bold' : 'normal',
            formatter: ({ value }) => value.toFixed(1)
          }
        };
      });
    }

    let chart;
    
    function initChart() {
      const chartElement = document.getElementById('chart');
      if (!chartElement) return;
      
      chart = echarts.init(chartElement);
      colors = getThemeColors();
      const data = createDataArray();
      
      const option = {
        backgroundColor: 'transparent',
        grid: { left: 60, right: 30, top: 40, bottom: 160 },
        xAxis: {
          type: 'category',
          data: labels,
          axisLabel: {
            color: colors.textPrimary,
            fontSize: 12,
            rotate: 45,
            align: 'right',
            formatter: function (value) {
              const norm = normalize(value);
              if (solverModelsNorm.has(norm)) return '{red|' + value + '}';
              if (p1SeriesNorm.has(norm)) return '{purple|' + value + '}';
              return value;
            },
            rich: {
              purple: { fontWeight: 'bold', color: colors.purpleMain, fontSize: 13 },
              red: { fontWeight: 'bold', color: colors.redMain, fontSize: 13 }
            }
          },
          axisLine: { lineStyle: { color: colors.textPrimary, width: 2 } },
          axisTick: { lineStyle: { color: colors.textPrimary } }
        },
        yAxis: {
          type: 'value',
          min: 20,
          max: 45,
          interval: 5,
          name: 'Average Exam Score (Theory)',
          nameLocation: 'middle',
          nameGap: 40,
          nameTextStyle: { color: colors.textPrimary, fontSize: 16 },
          axisLabel: { color: colors.textPrimary, fontSize: 14 },
          axisLine: { lineStyle: { color: colors.textPrimary, width: 2 } },
          splitLine: { show: false }
        },
        tooltip: {
          trigger: 'axis',
          axisPointer: { type: 'shadow' },
          backgroundColor: colors.bgTooltip,
          borderColor: colors.tooltipBorder,
          textStyle: { color: colors.textPrimary },
          formatter: function(params) {
            const d = params[0];
            const idx = labels.indexOf(d.name);
            return `<strong>${d.name.replace(/\n/g, ' ')}</strong><br/>Score: ${d.value.toFixed(1)}<br/>Medals: ${medals[idx]}`;
          }
        },
        series: [{
          type: 'bar',
          data: data,
          barWidth: '65%',
          emphasis: { focus: 'series' }
        }]
      };
      
      chart.setOption(option);
      updateLegend();
      
      const titleEl = document.querySelector('.title');
      if (titleEl) titleEl.style.color = colors.textPrimary;
    }

    function updateLegend() {
      const legendEl = document.getElementById('legend');
      if (!legendEl) return;
      
      // 生成渐变色块
      let gradientHtml = '';
      for (let m = maxMedals; m >= minMedals; m--) {
        gradientHtml += `<div class="medal-gradient-item" style="background:${medalToColor(m)}"></div>`;
      }
      
      legendEl.innerHTML = `
        <div class="legend-item">
          <span class="legend-swatch" style="background:${medalToColor(10)}"></span>
          <span>Open-source</span>
        </div>
        <div class="legend-item">
          <span class="legend-swatch" style="background: repeating-linear-gradient(45deg, ${colors.stripeColor} 0 2px, ${medalToColor(10)} 2px 4px);"></span>
          <span>Closed-source</span>
        </div>
        <div class="medal-legend">
          <span>Medals ${maxMedals}</span>
          <div class="medal-gradient">${gradientHtml}</div>
          <span>${minMedals}</span>
        </div>
      `;
      
      legendEl.querySelectorAll('.legend-item, .medal-legend').forEach(item => {
        item.style.color = colors.textPrimary;
      });
    }

    function updateChartColors() {
      if (!chart) return;
      colors = getThemeColors();
      
      const option = chart.getOption();
      option.xAxis[0].axisLabel.color = colors.textPrimary;
      option.xAxis[0].axisLabel.rich.purple.color = colors.purpleMain;
      option.xAxis[0].axisLabel.rich.red.color = colors.redMain;
      option.xAxis[0].axisLine.lineStyle.color = colors.textPrimary;
      option.yAxis[0].axisLabel.color = colors.textPrimary;
      option.yAxis[0].axisLine.lineStyle.color = colors.textPrimary;
      option.yAxis[0].nameTextStyle.color = colors.textPrimary;
      option.tooltip[0].backgroundColor = colors.bgTooltip;
      option.tooltip[0].textStyle.color = colors.textPrimary;
      
      option.series[0].data = createDataArray();
      chart.setOption(option, true);
      
      updateLegend();
      const titleEl = document.querySelector('.title');
      if (titleEl) titleEl.style.color = colors.textPrimary;
    }

    function waitForECharts() {
      if (typeof echarts !== 'undefined') {
        if (document.readyState === 'loading') {
          document.addEventListener('DOMContentLoaded', () => setTimeout(initChart, 100));
        } else {
          setTimeout(initChart, 100);
        }
      } else {
        setTimeout(waitForECharts, 50);
      }
    }
    
    waitForECharts();

    window.addEventListener('message', function(event) {
      if (event.data && event.data.type === 'themeChange') {
        setTheme(event.data.theme);
        updateChartColors();
      }
    });

    window.addEventListener('resize', () => { if (chart) chart.resize(); });
  </script>
</body>
</html>

